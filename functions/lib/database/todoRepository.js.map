{"version":3,"file":"todoRepository.js","names":["_firebaseAdmin","_interopRequireDefault","require","_serviceAccount","_prepareDocs","obj","__esModule","default","admin","initializeApp","credential","cert","serviceAccount","db","firestore","todoRef","collection","getList","snapshot","get","prepareDocs","docs","create","title","res","add","completed","newTodo","id","updateTodos","array","Promise","all","map","docId","runTransaction","t","doc","updatedStatus","data","update","removeTodos","batch","docRef","delete","commit"],"sources":["../../src/database/todoRepository.js"],"sourcesContent":["import admin from \"firebase-admin\";\r\nimport serviceAccount from \"../serviceAccount.json\";\r\nimport prepareDocs from \"../helpers/prepareDocs\";\r\n\r\nadmin.initializeApp({\r\n  credential: admin.credential.cert(serviceAccount),\r\n});\r\nconst db = admin.firestore();\r\nconst todoRef = db.collection(\"todos\");\r\n\r\nexport async function getList() {\r\n  const snapshot = await todoRef.get();\r\n  return prepareDocs(snapshot.docs);\r\n}\r\n\r\nexport async function create({ title }) {\r\n  const res = await todoRef.add({\r\n    title: title,\r\n    completed: false,\r\n  });\r\n  const newTodo = { id: res.id, title: title, completed: false }; // ko get lại dữ liệu vừa tạo\r\n  return newTodo;\r\n}\r\n\r\nexport async function updateTodos(array) {\r\n  await Promise.all(\r\n    array.map(async (docId) => {\r\n      await db.runTransaction(async (t) => {\r\n        const doc = await t.get(todoRef.doc(docId));\r\n        const updatedStatus = !doc.data().completed;\r\n        t.update(todoRef.doc(docId), { completed: updatedStatus });\r\n      });\r\n    })\r\n  );\r\n}\r\n\r\nexport async function removeTodos(array) {\r\n  const batch = db.batch();\r\n\r\n  await Promise.all(\r\n    array.map((docId) => {\r\n      let docRef = todoRef.doc(docId);\r\n      batch.delete(docRef);\r\n    })\r\n  );\r\n\r\n  await batch.commit();\r\n}\r\n"],"mappings":";;;;;;;;;AAAA,IAAAA,cAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,eAAA,GAAAF,sBAAA,CAAAC,OAAA;AACA,IAAAE,YAAA,GAAAH,sBAAA,CAAAC,OAAA;AAAiD,SAAAD,uBAAAI,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAEjDG,sBAAK,CAACC,aAAa,CAAC;EAClBC,UAAU,EAAEF,sBAAK,CAACE,UAAU,CAACC,IAAI,CAACC,uBAAc;AAClD,CAAC,CAAC;AACF,MAAMC,EAAE,GAAGL,sBAAK,CAACM,SAAS,CAAC,CAAC;AAC5B,MAAMC,OAAO,GAAGF,EAAE,CAACG,UAAU,CAAC,OAAO,CAAC;AAE/B,eAAeC,OAAOA,CAAA,EAAG;EAC9B,MAAMC,QAAQ,GAAG,MAAMH,OAAO,CAACI,GAAG,CAAC,CAAC;EACpC,OAAO,IAAAC,oBAAW,EAACF,QAAQ,CAACG,IAAI,CAAC;AACnC;AAEO,eAAeC,MAAMA,CAAC;EAAEC;AAAM,CAAC,EAAE;EACtC,MAAMC,GAAG,GAAG,MAAMT,OAAO,CAACU,GAAG,CAAC;IAC5BF,KAAK,EAAEA,KAAK;IACZG,SAAS,EAAE;EACb,CAAC,CAAC;EACF,MAAMC,OAAO,GAAG;IAAEC,EAAE,EAAEJ,GAAG,CAACI,EAAE;IAAEL,KAAK,EAAEA,KAAK;IAAEG,SAAS,EAAE;EAAM,CAAC,CAAC,CAAC;EAChE,OAAOC,OAAO;AAChB;AAEO,eAAeE,WAAWA,CAACC,KAAK,EAAE;EACvC,MAAMC,OAAO,CAACC,GAAG,CACfF,KAAK,CAACG,GAAG,CAAC,MAAOC,KAAK,IAAK;IACzB,MAAMrB,EAAE,CAACsB,cAAc,CAAC,MAAOC,CAAC,IAAK;MACnC,MAAMC,GAAG,GAAG,MAAMD,CAAC,CAACjB,GAAG,CAACJ,OAAO,CAACsB,GAAG,CAACH,KAAK,CAAC,CAAC;MAC3C,MAAMI,aAAa,GAAG,CAACD,GAAG,CAACE,IAAI,CAAC,CAAC,CAACb,SAAS;MAC3CU,CAAC,CAACI,MAAM,CAACzB,OAAO,CAACsB,GAAG,CAACH,KAAK,CAAC,EAAE;QAAER,SAAS,EAAEY;MAAc,CAAC,CAAC;IAC5D,CAAC,CAAC;EACJ,CAAC,CACH,CAAC;AACH;AAEO,eAAeG,WAAWA,CAACX,KAAK,EAAE;EACvC,MAAMY,KAAK,GAAG7B,EAAE,CAAC6B,KAAK,CAAC,CAAC;EAExB,MAAMX,OAAO,CAACC,GAAG,CACfF,KAAK,CAACG,GAAG,CAAEC,KAAK,IAAK;IACnB,IAAIS,MAAM,GAAG5B,OAAO,CAACsB,GAAG,CAACH,KAAK,CAAC;IAC/BQ,KAAK,CAACE,MAAM,CAACD,MAAM,CAAC;EACtB,CAAC,CACH,CAAC;EAED,MAAMD,KAAK,CAACG,MAAM,CAAC,CAAC;AACtB"}