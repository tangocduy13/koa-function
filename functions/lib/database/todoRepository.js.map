{"version":3,"file":"todoRepository.js","names":["_firebaseAdmin","_interopRequireDefault","require","_serviceAccount","_prepareDocs","obj","__esModule","default","admin","initializeApp","credential","cert","serviceAccount","db","firestore","todoRef","collection","getList","snapshot","get","todos","forEach","doc","todo","id","data","push","create","title","res","add","completed","newTodoSnapshot","newTodo","updateMany","array","docId","runTransaction","t","updatedStatus","update","removeMany","batch","console","log","docRef","delete","commit"],"sources":["../../src/database/todoRepository.js"],"sourcesContent":["import admin from \"firebase-admin\";\r\nimport serviceAccount from \"../serviceAccount.json\";\r\nimport prepareDocs from \"../helpers/prepareDocs\";\r\n\r\nadmin.initializeApp({\r\n  credential: admin.credential.cert(serviceAccount),\r\n});\r\nconst db = admin.firestore();\r\nconst todoRef = db.collection(\"todos\");\r\n\r\nexport async function getList() {\r\n  const snapshot = await todoRef.get();\r\n  let todos = [];\r\n  snapshot.forEach((doc) => {\r\n    let todo = { id: doc.id, ...doc.data() };\r\n    todos.push(todo);\r\n  });\r\n  return todos;\r\n}\r\n\r\nexport async function create({ title }) {\r\n  const res = await todoRef.add({\r\n    title: title,\r\n    completed: false,\r\n  });\r\n  const newTodoSnapshot = await res.get();\r\n  const newTodo = { id: newTodoSnapshot.id, ...newTodoSnapshot.data() };\r\n  return newTodo;\r\n}\r\n\r\nexport async function updateMany(array) {\r\n  array.forEach(async (docId) => {\r\n    await db.runTransaction(async (t) => {\r\n      const doc = await t.get(todoRef.doc(docId));\r\n      const updatedStatus = !doc.data().completed;\r\n      t.update(todoRef.doc(docId), { completed: updatedStatus });\r\n    });\r\n  });\r\n}\r\n\r\nexport async function removeMany(array) {\r\n  const batch = db.batch();\r\n  console.log(array);\r\n  array.forEach((docId) => {\r\n    let docRef = todoRef.doc(docId);\r\n    batch.delete(docRef);\r\n  });\r\n\r\n  await batch.commit();\r\n}\r\n"],"mappings":";;;;;;;;;AAAA,IAAAA,cAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,eAAA,GAAAF,sBAAA,CAAAC,OAAA;AACA,IAAAE,YAAA,GAAAH,sBAAA,CAAAC,OAAA;AAAiD,SAAAD,uBAAAI,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAEjDG,sBAAK,CAACC,aAAa,CAAC;EAClBC,UAAU,EAAEF,sBAAK,CAACE,UAAU,CAACC,IAAI,CAACC,uBAAc;AAClD,CAAC,CAAC;AACF,MAAMC,EAAE,GAAGL,sBAAK,CAACM,SAAS,CAAC,CAAC;AAC5B,MAAMC,OAAO,GAAGF,EAAE,CAACG,UAAU,CAAC,OAAO,CAAC;AAE/B,eAAeC,OAAOA,CAAA,EAAG;EAC9B,MAAMC,QAAQ,GAAG,MAAMH,OAAO,CAACI,GAAG,CAAC,CAAC;EACpC,IAAIC,KAAK,GAAG,EAAE;EACdF,QAAQ,CAACG,OAAO,CAAEC,GAAG,IAAK;IACxB,IAAIC,IAAI,GAAG;MAAEC,EAAE,EAAEF,GAAG,CAACE,EAAE;MAAE,GAAGF,GAAG,CAACG,IAAI,CAAC;IAAE,CAAC;IACxCL,KAAK,CAACM,IAAI,CAACH,IAAI,CAAC;EAClB,CAAC,CAAC;EACF,OAAOH,KAAK;AACd;AAEO,eAAeO,MAAMA,CAAC;EAAEC;AAAM,CAAC,EAAE;EACtC,MAAMC,GAAG,GAAG,MAAMd,OAAO,CAACe,GAAG,CAAC;IAC5BF,KAAK,EAAEA,KAAK;IACZG,SAAS,EAAE;EACb,CAAC,CAAC;EACF,MAAMC,eAAe,GAAG,MAAMH,GAAG,CAACV,GAAG,CAAC,CAAC;EACvC,MAAMc,OAAO,GAAG;IAAET,EAAE,EAAEQ,eAAe,CAACR,EAAE;IAAE,GAAGQ,eAAe,CAACP,IAAI,CAAC;EAAE,CAAC;EACrE,OAAOQ,OAAO;AAChB;AAEO,eAAeC,UAAUA,CAACC,KAAK,EAAE;EACtCA,KAAK,CAACd,OAAO,CAAC,MAAOe,KAAK,IAAK;IAC7B,MAAMvB,EAAE,CAACwB,cAAc,CAAC,MAAOC,CAAC,IAAK;MACnC,MAAMhB,GAAG,GAAG,MAAMgB,CAAC,CAACnB,GAAG,CAACJ,OAAO,CAACO,GAAG,CAACc,KAAK,CAAC,CAAC;MAC3C,MAAMG,aAAa,GAAG,CAACjB,GAAG,CAACG,IAAI,CAAC,CAAC,CAACM,SAAS;MAC3CO,CAAC,CAACE,MAAM,CAACzB,OAAO,CAACO,GAAG,CAACc,KAAK,CAAC,EAAE;QAAEL,SAAS,EAAEQ;MAAc,CAAC,CAAC;IAC5D,CAAC,CAAC;EACJ,CAAC,CAAC;AACJ;AAEO,eAAeE,UAAUA,CAACN,KAAK,EAAE;EACtC,MAAMO,KAAK,GAAG7B,EAAE,CAAC6B,KAAK,CAAC,CAAC;EACxBC,OAAO,CAACC,GAAG,CAACT,KAAK,CAAC;EAClBA,KAAK,CAACd,OAAO,CAAEe,KAAK,IAAK;IACvB,IAAIS,MAAM,GAAG9B,OAAO,CAACO,GAAG,CAACc,KAAK,CAAC;IAC/BM,KAAK,CAACI,MAAM,CAACD,MAAM,CAAC;EACtB,CAAC,CAAC;EAEF,MAAMH,KAAK,CAACK,MAAM,CAAC,CAAC;AACtB"}